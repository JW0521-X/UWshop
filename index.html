<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>U.W 二手商店</title>
<link rel="stylesheet" href="css/style.css">
<style>
  /* 跑馬燈 */
  #marquee {
    position: fixed;
    top: 120px; 
    left: 100%;
    white-space: nowrap;
    padding: 0.5rem 1rem;
    background: rgba(255, 250, 229, 0.15);
    color: #f5f5f5;
    font-weight: bold;
    font-size: 14px;
    border-radius: 5px;
    z-index: 9999;
    animation: marqueeAnim 15s linear infinite;
  }
  @keyframes marqueeAnim {
    0% { left: 100%; }
    100% { left: -100%; }
  }

  /* 帳戶按鈕 */
  #account {
    position: fixed;
    top: 20px;
    right: 20px;
    font-family: Arial, sans-serif;
    z-index: 1000;
  }
  #account button {
    margin-left: 10px;
    padding:6px 12px;
    border:none;
    border-radius:6px;
    background: linear-gradient(45deg,#2196F3,#1E88E5);
    color:white;
    cursor:pointer;
    font-size:14px;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  #account button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }
</style>
</head>
<body>
  <header>
    <h1 style="text-align:center;color:#fff;margin:2rem 0;">U.W 二手商店</h1>
  </header>

  <!-- 帳戶按鈕 -->
  <div id="account">
    <span id="accountText"></span>
    <button id="accountBtn">登入</button>
  </div>

  <!-- 跑馬燈公告 -->
  <div id="marquee">無標題--會自動更新</div>

  <main></main>

  <!-- JS -->
  <script>
  // 帳戶功能
  const accountText = document.getElementById("accountText");
  const accountBtn = document.getElementById("accountBtn");

  function updateAccountUI() {
    const token = localStorage.getItem("token");
    if(token){
      fetch("/api/users/me", {
        headers: { "Authorization": "Bearer " + token }
      }).then(res => res.json())
        .then(user => {
          accountText.textContent = `Hi, ${user.username}`;
          accountBtn.textContent = "登出";
        }).catch(()=>{
          localStorage.removeItem("token");
          accountText.textContent = "";
          accountBtn.textContent = "登入";
        });
    } else {
      accountText.textContent = "";
      accountBtn.textContent = "登入";
    }
  }

  accountBtn.addEventListener("click", ()=>{
    const token = localStorage.getItem("token");
    if(token){
      localStorage.removeItem("token");
      updateAccountUI();
    } else {
      window.location.href = "/login.html";
    }
  });

  updateAccountUI();

  // 跑馬燈公告
  async function loadMarquee() {
    try {
      const res = await fetch("/api/announcement");
      const data = await res.json();
      document.getElementById("marquee").textContent = data.text;
    } catch(err) {
      console.error("無法讀取公告", err);
    }
  }

  loadMarquee();
  setInterval(loadMarquee, 5000);
  </script>

  <script src="js/main.js"></script>
</body>
</html>
